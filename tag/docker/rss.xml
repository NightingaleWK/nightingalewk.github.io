<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>雪漫城的风宅 • Posts by &#34;docker&#34; tag</title>
        <link>https://nightingalewk.cn</link>
        <description>この世界は好都合に未完成 だから知りたいんだ —— チ。-地球の運動について-</description>
        <language>zh-CN</language>
        <pubDate>Fri, 23 Jan 2026 18:00:00 +0800</pubDate>
        <lastBuildDate>Fri, 23 Jan 2026 18:00:00 +0800</lastBuildDate>
        <category>迁移</category>
        <category>hexo</category>
        <category>主食</category>
        <category>电脑维修</category>
        <category>学习笔记</category>
        <category>pr</category>
        <category>bilibili</category>
        <category>热菜</category>
        <category>梦境</category>
        <category>甜品</category>
        <category>汤</category>
        <category>海鲜</category>
        <category>homestead</category>
        <category>代码更新</category>
        <category>oneinstack</category>
        <category>lnmp</category>
        <category>代码部署</category>
        <category>dcat admin</category>
        <category>oh-my-zsh</category>
        <category>debug</category>
        <category>指令</category>
        <category>道歉信</category>
        <category>免密</category>
        <category>vs code</category>
        <category>laravel sail</category>
        <category>PAC 清单</category>
        <category>fileinfo</category>
        <category>定时任务</category>
        <category>gpg</category>
        <category>sshppass</category>
        <category>awk</category>
        <category>net time</category>
        <category>swap</category>
        <category>端口查询</category>
        <category>表单验证</category>
        <category>事件</category>
        <category>blade</category>
        <category>wordpress</category>
        <category>队列</category>
        <category>redis</category>
        <category>特色小吃</category>
        <category>粥</category>
        <category>Cloudreve</category>
        <category>故障排除</category>
        <category>artisan 指令</category>
        <category>Font Awesome</category>
        <category>vite</category>
        <category>linux</category>
        <category>我的世界</category>
        <category>Minecraft</category>
        <category>膝盖中箭之地</category>
        <category>领域</category>
        <category>realms</category>
        <category>公告</category>
        <category>screen</category>
        <category>cursor</category>
        <category>人工智能</category>
        <category>prompt</category>
        <category>打印机</category>
        <category>京瓷</category>
        <category>教程</category>
        <category>Git</category>
        <category>GitHub</category>
        <category>版本控制</category>
        <category>Monorepo</category>
        <category>DevOps</category>
        <category>Laravel</category>
        <category>Docker</category>
        <category>容器化</category>
        <category>部署</category>
        <category>运维</category>
        <category>国产化</category>
        <category>信创</category>
        <category>TongHttpServer</category>
        <category>Ubuntu</category>
        <category>安装指南</category>
        <category>阿里云</category>
        <category>镜像源</category>
        <category>Rule</category>
        <category>Prompt</category>
        <category>gemini</category>
        <category>Nginx</category>
        <category>反向代理</category>
        <category>NPM</category>
        <category>HTTPS</category>
        <category>问题排查</category>
        <category>Sail</category>
        <category>WSL2</category>
        <category>Artisan</category>
        <category>Composer</category>
        <category>Troubleshooting</category>
        <category>Hardware</category>
        <category>Tooling</category>
        <item>
            <guid isPermalink="true">https://nightingalewk.cn/2026/01/23/83.%20Laravel%20Sail%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B8%80%E6%8A%8A%E8%BF%87%EF%BC%88%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E7%AF%87%EF%BC%89/</guid>
            <title>Laravel Sail 开发环境部署一把过（环境配置篇）</title>
            <link>https://nightingalewk.cn/2026/01/23/83.%20Laravel%20Sail%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B8%80%E6%8A%8A%E8%BF%87%EF%BC%88%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E7%AF%87%EF%BC%89/</link>
            <category>Laravel</category>
            <category>Docker</category>
            <category>Sail</category>
            <category>WSL2</category>
            <pubDate>Fri, 23 Jan 2026 18:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;部署目标&#34;&gt;&lt;a href=&#34;#部署目标&#34; class=&#34;headerlink&#34; title=&#34;部署目标&#34;&gt;&lt;/a&gt;部署目标&lt;/h2&gt;&lt;p&gt;本文将从零开始构建基于 &lt;strong&gt;WSL2 (Windows Subsystem for Linux 2)&lt;/strong&gt; 的标准化 Docker 开发环境，并完成首个 Laravel Sail 项目的初始化。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;环境要求&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;OS&lt;/strong&gt;: Windows 11 (Build 22000+) 或 Windows 10 (Build 19041+).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BIOS&lt;/strong&gt;: 开启 CPU 虚拟化 (Virtualization Technology).&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;1-基础设施准备&#34;&gt;&lt;a href=&#34;#1-基础设施准备&#34; class=&#34;headerlink&#34; title=&#34;1. 基础设施准备&#34;&gt;&lt;/a&gt;1. 基础设施准备&lt;/h2&gt;&lt;h3 id=&#34;1-1-验证虚拟化支持&#34;&gt;&lt;a href=&#34;#1-1-验证虚拟化支持&#34; class=&#34;headerlink&#34; title=&#34;1.1 验证虚拟化支持&#34;&gt;&lt;/a&gt;1.1 验证虚拟化支持&lt;/h3&gt;&lt;p&gt;Docker Desktop 依赖 Hypervisor 层支持。请确保 BIOS&amp;#x2F;UEFI 中已开启虚拟化（Intel VT-x 或 AMD-V）。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;验证方式&lt;/em&gt;：任务管理器 -&amp;gt; 性能 -&amp;gt; CPU -&amp;gt; &lt;strong&gt;虚拟化：已启用&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;1-2-部署-WSL2&#34;&gt;&lt;a href=&#34;#1-2-部署-WSL2&#34; class=&#34;headerlink&#34; title=&#34;1.2 部署 WSL2&#34;&gt;&lt;/a&gt;1.2 部署 WSL2&lt;/h3&gt;&lt;p&gt;使用管理员权限打开 PowerShell 或 Windows Terminal，执行以下指令完成 WSL2 及 Ubuntu 发行版的自动安装：&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wsl &lt;span class=&#34;literal&#34;&gt;--install&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: 安装完成后需&lt;strong&gt;重启系统&lt;/strong&gt;。重启后会自动弹出终端窗口，按提示设置 UNIX 用户名与密码即可。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;1-3-安装-Docker-Desktop&#34;&gt;&lt;a href=&#34;#1-3-安装-Docker-Desktop&#34; class=&#34;headerlink&#34; title=&#34;1.3 安装 Docker Desktop&#34;&gt;&lt;/a&gt;1.3 安装 Docker Desktop&lt;/h3&gt;&lt;p&gt;下载并安装 &lt;a href=&#34;https://www.docker.com/products/docker-desktop/&#34;&gt;Docker Desktop for Windows&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;关键配置检查&lt;/strong&gt;：&lt;br&gt;安装向导中务必勾选 &lt;strong&gt;Use WSL 2 instead of Hyper-V&lt;/strong&gt;（通常为默认选中）。&lt;br&gt;启动后，进入 Settings -&amp;gt; Resources -&amp;gt; WSL Integration：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;确保 &lt;strong&gt;Enable integration with my default WSL distro&lt;/strong&gt; 为开启状态。&lt;/li&gt;
&lt;li&gt;在下方 distro 列表中，确保 &lt;strong&gt;Ubuntu&lt;/strong&gt; 处于开启状态。&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;2-初始化-Laravel-Sail-项目&#34;&gt;&lt;a href=&#34;#2-初始化-Laravel-Sail-项目&#34; class=&#34;headerlink&#34; title=&#34;2. 初始化 Laravel Sail 项目&#34;&gt;&lt;/a&gt;2. 初始化 Laravel Sail 项目&lt;/h2&gt;&lt;p&gt;所有后续操作建议直接在 WSL2 终端（Ubuntu）中执行，以获得原生的 Linux 开发体验。&lt;/p&gt;
&lt;h3 id=&#34;2-1-创建工作区&#34;&gt;&lt;a href=&#34;#2-1-创建工作区&#34; class=&#34;headerlink&#34; title=&#34;2.1 创建工作区&#34;&gt;&lt;/a&gt;2.1 创建工作区&lt;/h3&gt;&lt;p&gt;建议在 WSL 用户主目录下统一管理项目，避免 Windows 文件系统 (NTFS) 挂载带来的 I&amp;#x2F;O 性能损耗。&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;mkdir&lt;/span&gt; -p ~/code &amp;amp;&amp;amp; &lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; ~/code&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-2-构建项目&#34;&gt;&lt;a href=&#34;#2-2-构建项目&#34; class=&#34;headerlink&#34; title=&#34;2.2 构建项目&#34;&gt;&lt;/a&gt;2.2 构建项目&lt;/h3&gt;&lt;p&gt;使用 Laravel 官方构建脚本初始化项目（通过临时 Docker 容器）：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 请将 &amp;#x27;example-app&amp;#x27; 替换为实际项目名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;curl -s https://laravel.build/example-app | bash&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;该指令会自动拉取 &lt;code&gt;php-cli&lt;/code&gt; 镜像及相关依赖。&lt;/p&gt;
&lt;h3 id=&#34;2-3-配置-Shell-Alias-推荐&#34;&gt;&lt;a href=&#34;#2-3-配置-Shell-Alias-推荐&#34; class=&#34;headerlink&#34; title=&#34;2.3 配置 Shell Alias (推荐)&#34;&gt;&lt;/a&gt;2.3 配置 Shell Alias (推荐)&lt;/h3&gt;&lt;p&gt;为简化操作，建议将 &lt;code&gt;sail&lt;/code&gt; 执行脚本映射为 Shell 别名。编辑 &lt;code&gt;~/.bashrc&lt;/code&gt; 或 &lt;code&gt;~/.zshrc&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 添加至配置文件末尾&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;alias&lt;/span&gt; sail=&lt;span class=&#34;string&#34;&gt;&amp;#x27;[ -f sail ] &amp;amp;&amp;amp; bash sail || bash vendor/bin/sail&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;加载生效：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;source&lt;/span&gt; ~/.bashrc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h2 id=&#34;3-启动与验证&#34;&gt;&lt;a href=&#34;#3-启动与验证&#34; class=&#34;headerlink&#34; title=&#34;3. 启动与验证&#34;&gt;&lt;/a&gt;3. 启动与验证&lt;/h2&gt;&lt;h3 id=&#34;3-1-启动环境&#34;&gt;&lt;a href=&#34;#3-1-启动环境&#34; class=&#34;headerlink&#34; title=&#34;3.1 启动环境&#34;&gt;&lt;/a&gt;3.1 启动环境&lt;/h3&gt;&lt;p&gt;进入项目目录并后台启动 Sail 服务栈：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; ~/code/example-app&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sail up -d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Sail 将根据 &lt;code&gt;docker-compose.yml&lt;/code&gt;编排启动 PHP、MySQL、Redis 等容器。首次启动涉及镜像拉取，耗时取决于网络环境。&lt;/p&gt;
&lt;h3 id=&#34;3-2-服务验证&#34;&gt;&lt;a href=&#34;#3-2-服务验证&#34; class=&#34;headerlink&#34; title=&#34;3.2 服务验证&#34;&gt;&lt;/a&gt;3.2 服务验证&lt;/h3&gt;&lt;p&gt;服务启动后，通过宿主机浏览器访问 &lt;code&gt;http://localhost&lt;/code&gt;。&lt;br&gt;若显示 Laravel 欢迎页，即表示：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ Docker 容器运行正常&lt;/li&gt;
&lt;li&gt;✅ 端口转发 (Port Forwarding) 正常&lt;/li&gt;
&lt;li&gt;✅ PHP 运行时挂载正常&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;下一步&#34;&gt;&lt;a href=&#34;#下一步&#34; class=&#34;headerlink&#34; title=&#34;下一步&#34;&gt;&lt;/a&gt;下一步&lt;/h2&gt;&lt;p&gt;基础环境已就绪。下一章节我们将讨论&lt;strong&gt;多端协作场景&lt;/strong&gt;：如何基于 Git 管理代码，并在不同设备间实现无缝的依赖引导与环境同步。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://nightingalewk.cn/2025/10/13/80.%20Laravel%20%E9%A1%B9%E7%9B%AE%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%90%8E%EF%BC%8C%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5%E5%A4%9A%E5%87%BA%E4%B8%AA%2080%20%E7%AB%AF%E5%8F%A3%E5%AD%97%E6%A0%B7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</guid>
            <title>Laravel 项目容器化部署生产环境后，资源链接多出个 80 端口字样解决方案</title>
            <link>https://nightingalewk.cn/2025/10/13/80.%20Laravel%20%E9%A1%B9%E7%9B%AE%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%90%8E%EF%BC%8C%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5%E5%A4%9A%E5%87%BA%E4%B8%AA%2080%20%E7%AB%AF%E5%8F%A3%E5%AD%97%E6%A0%B7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</link>
            <category>Laravel</category>
            <category>Docker</category>
            <category>Nginx</category>
            <category>反向代理</category>
            <category>NPM</category>
            <category>HTTPS</category>
            <category>问题排查</category>
            <pubDate>Mon, 13 Oct 2025 10:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;前言&#34;&gt;&lt;a href=&#34;#前言&#34; class=&#34;headerlink&#34; title=&#34;前言&#34;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近在阿里云服务器上部署一个基于 Laravel 12 + Filament v4 的项目（代号“土豆食堂”），使用 Docker Compose 容器化部署，后端 Nginx + PHP-FPM，前端通过 Nginx Proxy Manager (NPM) 实现 HTTPS 反向代理。部署完成后，一切看似正常，但访问应用时发现前端资源（如 Filament 的 &lt;code&gt;app.js&lt;/code&gt;）的 URL 被错误生成成 &lt;code&gt;https://lynx.wkarrow.top:80/js/filament/filament/app.js?v=4.1.6.0&lt;/code&gt;，多出的 &lt;code&gt;:80&lt;/code&gt; 端口导致浏览器无法加载资源，报 404 错误。&lt;/p&gt;
&lt;p&gt;这不是代码 bug，而是典型的 HTTPS 代理到 HTTP 后端的头部传递问题。NPM 默认将 &lt;code&gt;X-Forwarded-Port&lt;/code&gt; 设置为后端端口 80，而 Laravel 在生成资产 URL 时会根据此头部附加端口，导致与 HTTPS scheme 不匹配。&lt;/p&gt;
&lt;p&gt;本文记录了问题排查与最终解决方案，重点分享后端 Nginx 的备选修复方法（适用于 NPM 配置无效的情况）。希望对类似部署遇到坑的开发者有帮助！&lt;/p&gt;
&lt;h2 id=&#34;问题复现与分析&#34;&gt;&lt;a href=&#34;#问题复现与分析&#34; class=&#34;headerlink&#34; title=&#34;问题复现与分析&#34;&gt;&lt;/a&gt;问题复现与分析&lt;/h2&gt;&lt;h3 id=&#34;环境概述&#34;&gt;&lt;a href=&#34;#环境概述&#34; class=&#34;headerlink&#34; title=&#34;环境概述&#34;&gt;&lt;/a&gt;环境概述&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;项目&lt;/strong&gt;：Laravel 12 + Filament v4，使用 Vite 构建前端资源。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;部署&lt;/strong&gt;：Docker Compose（&lt;code&gt;docker-compose.internet.yml&lt;/code&gt;），包含 app (PHP-FPM)、nginx、mysql、redis 等服务。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;代理&lt;/strong&gt;：NPM 监听 443 端口，强制 HTTPS，转发到后端 Nginx 的 80 端口。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Nginx 配置&lt;/strong&gt;：&lt;code&gt;default.conf&lt;/code&gt; 中已传递 &lt;code&gt;X-Forwarded-*&lt;/code&gt; 头部到 PHP-FPM。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;故障现象&#34;&gt;&lt;a href=&#34;#故障现象&#34; class=&#34;headerlink&#34; title=&#34;故障现象&#34;&gt;&lt;/a&gt;故障现象&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;正常预期：&lt;code&gt;https://lynx.wkarrow.top/js/filament/filament/app.js?v=4.1.6.0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;实际生成：&lt;code&gt;https://lynx.wkarrow.top:80/js/filament/filament/app.js?v=4.1.6.0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;影响：浏览器 Network 面板显示资源 404，应用界面 JS&amp;#x2F;CSS 加载失败，Filament 面板无法交互。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;根因分析&#34;&gt;&lt;a href=&#34;#根因分析&#34; class=&#34;headerlink&#34; title=&#34;根因分析&#34;&gt;&lt;/a&gt;根因分析&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;NPM 作为前端代理，添加 &lt;code&gt;X-Forwarded-Proto: https&lt;/code&gt; 和 &lt;code&gt;X-Forwarded-Port: 80&lt;/code&gt;（后端端口）。&lt;/li&gt;
&lt;li&gt;后端 Nginx 将这些头部传递给 PHP-FPM（&lt;code&gt;fastcgi_param HTTP_X_FORWARDED_PORT $http_x_forwarded_port;&lt;/code&gt;）。&lt;/li&gt;
&lt;li&gt;Laravel 的 &lt;code&gt;Request&lt;/code&gt; 对象信任代理头部（&lt;code&gt;config/trustedproxies.php&lt;/code&gt;），读取 &lt;code&gt;X-Forwarded-Port=80&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;URL 生成器（如 &lt;code&gt;asset()&lt;/code&gt; 或 Filament 的资源 URL）检测到端口非 HTTPS 默认 443，故附加 &lt;code&gt;:80&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;参考 Laravel 12 文档（HTTP Requests 部分）：&lt;code&gt;request()-&amp;gt;getPort()&lt;/code&gt; 优先从 &lt;code&gt;X-Forwarded-Port&lt;/code&gt; 取值，导致畸形 URL。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这是一个常见痛点，尤其在 Docker + 反向代理环境中。&lt;/p&gt;
&lt;h2 id=&#34;解决方案&#34;&gt;&lt;a href=&#34;#解决方案&#34; class=&#34;headerlink&#34; title=&#34;解决方案&#34;&gt;&lt;/a&gt;解决方案&lt;/h2&gt;&lt;p&gt;我先尝试了在 NPM 的 Advanced 选项卡添加 &lt;code&gt;proxy_set_header X-Forwarded-Port 443;&lt;/code&gt;，但由于 NPM 的自定义配置有时不稳定（可能与版本或缓存相关），最终选择了后端 Nginx 的备选修复——直接在 &lt;code&gt;default.conf&lt;/code&gt; 中覆盖端口逻辑。这方法更可靠，且不依赖代理工具。&lt;/p&gt;
&lt;h3 id=&#34;步骤：修改后端-Nginx-配置&#34;&gt;&lt;a href=&#34;#步骤：修改后端-Nginx-配置&#34; class=&#34;headerlink&#34; title=&#34;步骤：修改后端 Nginx 配置&#34;&gt;&lt;/a&gt;步骤：修改后端 Nginx 配置&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;编辑配置文件&lt;/strong&gt;：在项目目录下，打开 &lt;code&gt;./docker-internet/nginx/default.conf&lt;/code&gt;（或挂载路径 &lt;code&gt;/etc/nginx/conf.d/default.conf&lt;/code&gt;）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;定位 PHP 处理块&lt;/strong&gt;：找到 &lt;code&gt;location ~ \.php$&lt;/code&gt; 部分（已存在 FastCGI 配置）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;添加覆盖逻辑&lt;/strong&gt;：在 &lt;code&gt;fastcgi_param&lt;/code&gt; 相关行后，插入以下 Nginx 指令：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;location ~ \.php$ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    try_files $uri =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_split_path_info ^(.+\.php)(/.+)$;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_pass app:9000;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_index index.php;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    include fastcgi_params;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param PATH_INFO $fastcgi_path_info;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # 原有头部传递&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param HTTP_X_FORWARDED_FOR $http_x_forwarded_for;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param HTTP_X_FORWARDED_PROTO $http_x_forwarded_proto;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param HTTP_X_FORWARDED_HOST $http_x_forwarded_host;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param HTTP_X_FORWARDED_PORT $http_x_forwarded_port;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # 新增：基于 proto 覆盖端口，确保 HTTPS 时为 443&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    set $real_port $http_x_forwarded_port;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if ($http_x_forwarded_proto = &amp;quot;https&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        set $real_port &amp;quot;443&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    fastcgi_param HTTP_X_FORWARDED_PORT $real_port;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;解释&lt;/strong&gt;：&lt;ul&gt;
&lt;li&gt;&lt;code&gt;set $real_port $http_x_forwarded_port;&lt;/code&gt;：默认使用传入端口。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;if ($http_x_forwarded_proto = &amp;quot;https&amp;quot;) &amp;#123; set $real_port &amp;quot;443&amp;quot;; &amp;#125;&lt;/code&gt;：如果 scheme 是 HTTPS，则强制覆盖为 443（忽略后端 80）。&lt;/li&gt;
&lt;li&gt;最后用 &lt;code&gt;$real_port&lt;/code&gt; 替换原参数，确保 Laravel 读取正确端口。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;保存并重启服务&lt;/strong&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo docker compose -f docker-compose.internet.yml restart nginx&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Nginx 会优雅重载，无需重建整个容器。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;辅助优化&lt;/strong&gt;（可选，但推荐）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;确认 &lt;code&gt;.env&lt;/code&gt; 中的 &lt;code&gt;APP_URL=https://lynx.wkarrow.top&lt;/code&gt;（无端口）。&lt;/li&gt;
&lt;li&gt;清除 Laravel 缓存：&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo docker compose -f docker-compose.internet.yml exec app php artisan config:clear&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo docker compose -f docker-compose.internet.yml exec app php artisan cache:clear&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo docker compose -f docker-compose.internet.yml exec app php artisan optimize&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;验证与测试&#34;&gt;&lt;a href=&#34;#验证与测试&#34; class=&#34;headerlink&#34; title=&#34;验证与测试&#34;&gt;&lt;/a&gt;验证与测试&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;浏览器测试&lt;/strong&gt;：清空缓存，访问 &lt;code&gt;https://lynx.wkarrow.top&lt;/code&gt;，打开 F12 &amp;gt; Network，检查资源 URL（如 &lt;code&gt;app.js&lt;/code&gt;）是否无 &lt;code&gt;:80&lt;/code&gt;，并确认 200 OK。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;命令行验证&lt;/strong&gt;：&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;curl -I https://lynx.wkarrow.top/js/filament/filament/app.js&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
预期返回 200，无重定向或 404。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;日志检查&lt;/strong&gt;：若仍有问题，查看容器日志：&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo docker compose -f docker-compose.internet.yml logs nginx app | grep -i &amp;quot;forwarded\|port&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;修复后，Filament 面板加载顺畅，前端交互完美！&lt;/p&gt;
&lt;h2 id=&#34;总结与建议&#34;&gt;&lt;a href=&#34;#总结与建议&#34; class=&#34;headerlink&#34; title=&#34;总结与建议&#34;&gt;&lt;/a&gt;总结与建议&lt;/h2&gt;&lt;p&gt;这个坑让我意识到，在容器化部署中，代理头部的处理至关重要。优先尝试 NPM 的 Advanced 配置，如果无效，后端 Nginx 的 &lt;code&gt;if&lt;/code&gt; 逻辑是稳妥备选。未来更新项目时，记得 git pull 后检查此配置是否覆盖。&lt;/p&gt;
&lt;p&gt;如果您也遇到类似问题，欢迎评论区交流！项目源码在 &lt;a href=&#34;https://github.com/NightingaleWK/lynx&#34;&gt;GitHub&lt;/a&gt; 开源中，星标支持下～&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参考&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Laravel 12 文档：HTTP Requests&lt;/li&gt;
&lt;li&gt;Nginx Proxy Manager 官方指南：Advanced Tab&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;本文基于实际部署经验撰写，如有疑问，欢迎讨论。&lt;/em&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://nightingalewk.cn/2025/10/10/79.%20%E5%9C%A8%20Ubuntu%2024.04%20%E7%94%A8%20APT%20%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%9A%84%20Docker%20Engine%20%E7%9A%84%E6%96%B9%E6%B3%95/</guid>
            <title>在 Ubuntu 24.04 用 APT 安装最新的 Docker Engine 的方法</title>
            <link>https://nightingalewk.cn/2025/10/10/79.%20%E5%9C%A8%20Ubuntu%2024.04%20%E7%94%A8%20APT%20%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%9A%84%20Docker%20Engine%20%E7%9A%84%E6%96%B9%E6%B3%95/</link>
            <category>Docker</category>
            <category>Ubuntu</category>
            <category>安装指南</category>
            <category>阿里云</category>
            <category>镜像源</category>
            <pubDate>Fri, 10 Oct 2025 10:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;文本将记录当前如何在阿里云 CES 服务器上，使用 APT 方式，安装最新的 Docker Engine 到 Ubuntu Server 24.04 上。主要解决的是国内因网络环境导致的资源无法下载、获取的问题。&lt;/p&gt;
&lt;p&gt;本文全部操作是基于&lt;a href=&#34;https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository&#34;&gt;官方的完整文档&lt;/a&gt;，仅对网络故障进行了处理，其他步骤均未改变。&lt;/p&gt;
&lt;h2 id=&#34;1-设置-Docker-的-apt-存储库&#34;&gt;&lt;a href=&#34;#1-设置-Docker-的-apt-存储库&#34; class=&#34;headerlink&#34; title=&#34;1. 设置 Docker 的 apt 存储库&#34;&gt;&lt;/a&gt;1. 设置 Docker 的 apt 存储库&lt;/h2&gt;&lt;p&gt;在全新干净的服务器上，配置 apt 存储库，原本官方的方法是这样的：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# Add Docker&amp;#x27;s official GPG key:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; apt-get update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; apt-get install ca-certificates curl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; install -m 0755 -d /etc/apt/keyrings&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;chmod&lt;/span&gt; a+r /etc/apt/keyrings/docker.asc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# Add the repository to Apt sources:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;string&#34;&gt;&amp;quot;deb [arch=&lt;span class=&#34;subst&#34;&gt;$(dpkg --print-architecture)&lt;/span&gt; signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;  &lt;span class=&#34;subst&#34;&gt;$(. /etc/os-release &amp;amp;&amp;amp; echo &lt;span class=&#34;string&#34;&gt;&amp;quot;&lt;span class=&#34;variable&#34;&gt;$&amp;#123;UBUNTU_CODENAME:-&lt;span class=&#34;variable&#34;&gt;$VERSION_CODENAME&lt;/span&gt;&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;)&lt;/span&gt; stable&amp;quot;&lt;/span&gt; | \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; apt-get update&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;很明显，基于 docker.com 的资源都被墙的七七八八了，根本无法顺利执行完毕，我们这里替换阿里源：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 添加阿里云镜像站的 Docker GPG Key:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apt update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apt install ca-certificates curl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;install -m 0755 -d /etc/apt/keyrings&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;chmod&lt;/span&gt; a+r /etc/apt/keyrings/docker.gpg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 添加阿里云的 Docker APT 软件源（替换官方源）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;string&#34;&gt;&amp;quot;deb [arch=&lt;span class=&#34;subst&#34;&gt;$(dpkg --print-architecture)&lt;/span&gt; signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;  &lt;span class=&#34;subst&#34;&gt;$(. /etc/os-release &amp;amp;&amp;amp; echo &lt;span class=&#34;string&#34;&gt;&amp;quot;&lt;span class=&#34;variable&#34;&gt;$&amp;#123;UBUNTU_CODENAME:-&lt;span class=&#34;variable&#34;&gt;$VERSION_CODENAME&lt;/span&gt;&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;)&lt;/span&gt; stable&amp;quot;&lt;/span&gt; | \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 再次更新索引&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apt update&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;这里，若我们使用的是 debian 等其他的发行版，则需要将上述的 &lt;code&gt;https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg&lt;/code&gt; 替换为 &lt;code&gt;https://mirrors.aliyun.com/docker-ce/linux/debian/gpg&lt;/code&gt; 即可。也就是 &lt;code&gt;ubuntu&lt;/code&gt; 改为 &lt;code&gt;debian&lt;/code&gt;，其他操作系统以此类推。&lt;/p&gt;
&lt;h2 id=&#34;2-安装-Docker-包&#34;&gt;&lt;a href=&#34;#2-安装-Docker-包&#34; class=&#34;headerlink&#34; title=&#34;2. 安装 Docker 包&#34;&gt;&lt;/a&gt;2. 安装 Docker 包&lt;/h2&gt;&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;后续的按照官方文档操作即可，不再赘述了。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://nightingalewk.cn/2025/10/09/78.%20Laravel%20%E9%A1%B9%E7%9B%AE%20Docker%20%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4%E6%89%8B%E5%86%8C/</guid>
            <title>Laravel 项目 Docker 化部署与运维手册</title>
            <link>https://nightingalewk.cn/2025/10/09/78.%20Laravel%20%E9%A1%B9%E7%9B%AE%20Docker%20%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4%E6%89%8B%E5%86%8C/</link>
            <category>Laravel</category>
            <category>Docker</category>
            <category>容器化</category>
            <category>部署</category>
            <category>运维</category>
            <pubDate>Thu, 09 Oct 2025 16:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;本文档详细记录了如何将 “土豆食堂” (Lynx) 这个 Laravel 12 项目通过 Docker 进行容器化打包、部署、运行及日常维护。&lt;/p&gt;
&lt;p&gt;个人项目，已开源：&lt;a href=&#34;https://github.com/NightingaleWK/lynx&#34;&gt;https://github.com/NightingaleWK/lynx&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;一、环境准备&#34;&gt;&lt;a href=&#34;#一、环境准备&#34; class=&#34;headerlink&#34; title=&#34;一、环境准备&#34;&gt;&lt;/a&gt;&lt;strong&gt;一、环境准备&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;在开始之前，请确保您的部署目标机器（例如 Windows 11）已安装并运行 Docker Desktop。&lt;/p&gt;
&lt;h2 id=&#34;二、项目改造（首次部署需执行）&#34;&gt;&lt;a href=&#34;#二、项目改造（首次部署需执行）&#34; class=&#34;headerlink&#34; title=&#34;二、项目改造（首次部署需执行）&#34;&gt;&lt;/a&gt;&lt;strong&gt;二、项目改造（首次部署需执行）&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;以下文件需要在您本地的项目代码中创建。&lt;/p&gt;
&lt;h3 id=&#34;1-目录结构&#34;&gt;&lt;a href=&#34;#1-目录结构&#34; class=&#34;headerlink&#34; title=&#34;1. 目录结构&#34;&gt;&lt;/a&gt;&lt;strong&gt;1. 目录结构&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;为了清晰地区分生产环境与 Sail 开发环境的配置，我们将所有生产部署相关的文件都存放在一个新的 docker-prod 目录中。&lt;/p&gt;
&lt;p&gt;在项目根目录下，创建如下的目录和文件结构：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;your-laravel-project/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;├── docker-prod/ # &amp;lt;-- 新建，存放所有生产环境配置&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;│ ├── app/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;│ │ └── Dockerfile&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;│ └── nginx/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;│ └── default.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;├── docker/# &amp;lt;-- 这是 Sail 的开发环境目录 (保留不变)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;├── docker-compose.prod.yml# &amp;lt;-- 新建 (注意文件名)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;└── .dockerignore# &amp;lt;-- 新建&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-创建核心配置文件&#34;&gt;&lt;a href=&#34;#2-创建核心配置文件&#34; class=&#34;headerlink&#34; title=&#34;2. 创建核心配置文件&#34;&gt;&lt;/a&gt;&lt;strong&gt;2. 创建核心配置文件&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;请根据后续提供的文件内容，在您的项目中创建或替换以下文件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;docker-compose.prod.yml (服务编排文件)&lt;/li&gt;
&lt;li&gt;docker-prod&amp;#x2F;app&amp;#x2F;Dockerfile (PHP 应用镜像构建文件)&lt;/li&gt;
&lt;li&gt;docker-prod&amp;#x2F;nginx&amp;#x2F;default.conf (Nginx 配置文件)&lt;/li&gt;
&lt;li&gt;.dockerignore (Docker 忽略文件)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-修改-Laravel-配置-env&#34;&gt;&lt;a href=&#34;#3-修改-Laravel-配置-env&#34; class=&#34;headerlink&#34; title=&#34;3. 修改 Laravel 配置 (.env)&#34;&gt;&lt;/a&gt;&lt;strong&gt;3. 修改 Laravel 配置 (.env)&lt;/strong&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;复制 .env.example 为 .env 文件。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;关键修改&lt;/strong&gt;：确保数据库和 Redis 的 HOST 指向 Docker Compose 中定义的服务名。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;APP_ENV=production&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;APP_DEBUG=false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;APP_KEY= # 留空，后续会通过命令生成&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DB_CONNECTION=mysql&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DB_HOST=mysql # &amp;lt;-- 必须是 mysql&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DB_PORT=3306&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DB_DATABASE=lynx# 您的数据库名&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DB_USERNAME=sail# 您的用户名&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DB_PASSWORD=password# 您的密码&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CACHE_DRIVER=redis&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;QUEUE_CONNECTION=redis&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SESSION_DRIVER=redis&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;REDIS_HOST=redis# &amp;lt;-- 必须是 redis&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;REDIS_PASSWORD=null&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;REDIS_PORT=6379&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;4-生成-SSL-证书-局域网-HTTPS&#34;&gt;&lt;a href=&#34;#4-生成-SSL-证书-局域网-HTTPS&#34; class=&#34;headerlink&#34; title=&#34;4. 生成 SSL 证书 (局域网 HTTPS)&#34;&gt;&lt;/a&gt;&lt;strong&gt;4. 生成 SSL 证书 (局域网 HTTPS)&lt;/strong&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;在项目根目录下创建目录 docker-prod&amp;#x2F;certs。&lt;/li&gt;
&lt;li&gt;打开终端 (如 Git Bash 或 WSL)，进入项目根目录，执行以下命令：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout docker-prod/ certs/lynx-key.pem -out docker-prod/certs/lynx.pem&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;重要提示&lt;/strong&gt;：在执行过程中，当提示输入 Common Name 时，&lt;strong&gt;请输入您部署机器的局域网 IP 地址&lt;/strong&gt;（例如 192.168.1.100）。&lt;/li&gt;
&lt;li&gt;执行后，请检查 docker-prod&amp;#x2F;certs 目录下是否已生成 lynx.pem 和 lynx-key.pem 两个文件。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;三、部署与初始化流程&#34;&gt;&lt;a href=&#34;#三、部署与初始化流程&#34; class=&#34;headerlink&#34; title=&#34;三、部署与初始化流程&#34;&gt;&lt;/a&gt;&lt;strong&gt;三、部署与初始化流程&lt;/strong&gt;&lt;/h2&gt;&lt;h3 id=&#34;步骤-1：构建并启动所有容器&#34;&gt;&lt;a href=&#34;#步骤-1：构建并启动所有容器&#34; class=&#34;headerlink&#34; title=&#34;步骤 1：构建并启动所有容器&#34;&gt;&lt;/a&gt;&lt;strong&gt;步骤 1：构建并启动所有容器&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;在项目根目录下，打开终端，执行以下命令。此命令会根据 Dockerfile 构建应用镜像，并以后台模式启动所有服务。&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# --no-cache 确保使用最新的基础镜像，避免缓存问题&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# --build 强制重新构建镜像&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml up -d --build --no-cache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;步骤-2：初始化-Laravel-应用&#34;&gt;&lt;a href=&#34;#步骤-2：初始化-Laravel-应用&#34; class=&#34;headerlink&#34; title=&#34;步骤 2：初始化 Laravel 应用&#34;&gt;&lt;/a&gt;&lt;strong&gt;步骤 2：初始化 Laravel 应用&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;容器首次启动后，数据库是空的，应用也没有配置密钥。我们需要进入 app 容器执行一系列初始化命令。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;生成应用密钥 (APP_KEY)&lt;/strong&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app php artisan key:generate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;运行数据库迁移:&lt;br&gt;此命令会根据 database&amp;#x2F;migrations 目录下的文件，在数据库中创建所有需要的数据表（包括 cache 表等）。\&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app php artisan migrate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;修正 storage 目录权限:&lt;br&gt;这是解决 “Permission denied” 错误的关键步骤。此命令将容器内的 storage 和 bootstrap&amp;#x2F;cache 目录的所有权交给 php-fpm 的运行用户 www-data。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app &lt;span class=&#34;built_in&#34;&gt;chown&lt;/span&gt; -R www-data:www-data storage bootstrap/cache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;（可选）填充测试数据:&lt;br&gt;如果您需要在测试时填充数据，可以运行此命令。请注意，生产环境不应执行此操作。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# --force 参数可以跳过生产环境的确认提示&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app php artisan db:seed --force&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;em&gt;注：若需填充数据，请确保 Dockerfile 中 composer install 命令&lt;strong&gt;没有&lt;/strong&gt;使用 –no-dev 参数，以保证 Faker 等开发包被安装。&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;步骤-3：访问您的应用&#34;&gt;&lt;a href=&#34;#步骤-3：访问您的应用&#34; class=&#34;headerlink&#34; title=&#34;步骤 3：访问您的应用&#34;&gt;&lt;/a&gt;&lt;strong&gt;步骤 3：访问您的应用&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;完成以上步骤后，您的应用已经成功部署并运行。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;打开浏览器，访问 https:&amp;#x2F;&amp;#x2F;&amp;lt;您的部署机器 IP&amp;gt;。&lt;/li&gt;
&lt;li&gt;浏览器会提示证书不安全，请选择“高级” -&amp;gt; “继续前往”。&lt;/li&gt;
&lt;li&gt;您应该能看到 Laravel 的欢迎页面或您的应用首页。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;四、日常运维命令&#34;&gt;&lt;a href=&#34;#四、日常运维命令&#34; class=&#34;headerlink&#34; title=&#34;四、日常运维命令&#34;&gt;&lt;/a&gt;&lt;strong&gt;四、日常运维命令&lt;/strong&gt;&lt;/h2&gt;&lt;h3 id=&#34;启动-停止服务&#34;&gt;&lt;a href=&#34;#启动-停止服务&#34; class=&#34;headerlink&#34; title=&#34;启动&amp;#x2F;停止服务&#34;&gt;&lt;/a&gt;&lt;strong&gt;启动&amp;#x2F;停止服务&lt;/strong&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;启动所有服务&lt;/strong&gt; (后台运行):&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml up -d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;停止并移除所有容器&lt;/strong&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml down&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;em&gt;此操作不会删除数据库和 Redis 的持久化数据。&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;查看状态与日志&#34;&gt;&lt;a href=&#34;#查看状态与日志&#34; class=&#34;headerlink&#34; title=&#34;查看状态与日志&#34;&gt;&lt;/a&gt;&lt;strong&gt;查看状态与日志&lt;/strong&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;查看所有容器的运行状态&lt;/strong&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml ps&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;实时查看所有服务的日志&lt;/strong&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml logs -f&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;只看特定服务的日志&lt;/strong&gt; (例如 app 或 queue-worker):&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml logs -f app&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml logs -f queue-worker&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;代码更新流程&#34;&gt;&lt;a href=&#34;#代码更新流程&#34; class=&#34;headerlink&#34; title=&#34;代码更新流程&#34;&gt;&lt;/a&gt;&lt;strong&gt;代码更新流程&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;当您通过 git pull 更新了项目代码后：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;重新构建镜像并重启服务&lt;/strong&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml up -d --build&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;（如果需要）运行新的数据库迁移&lt;/strong&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app php artisan migrate --force&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;（推荐）清理并重建配置缓存&lt;/strong&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app php artisan optimize:clear&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;执行-Artisan-命令&#34;&gt;&lt;a href=&#34;#执行-Artisan-命令&#34; class=&#34;headerlink&#34; title=&#34;执行 Artisan 命令&#34;&gt;&lt;/a&gt;&lt;strong&gt;执行 Artisan 命令&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;您可以在 app 容器内执行任何 Artisan 命令，语法如下：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose -f docker-compose.prod.yml &lt;span class=&#34;built_in&#34;&gt;exec&lt;/span&gt; app php artisan &amp;lt;您的命令&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;五、完整配置文件代码&#34;&gt;&lt;a href=&#34;#五、完整配置文件代码&#34; class=&#34;headerlink&#34; title=&#34;五、完整配置文件代码&#34;&gt;&lt;/a&gt;&lt;strong&gt;五、完整配置文件代码&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;为了方便您快速部署，以下提供了文中提及的所有配置文件的完整代码。&lt;/p&gt;
&lt;h3 id=&#34;1-docker-prod-app-Dockerfile&#34;&gt;&lt;a href=&#34;#1-docker-prod-app-Dockerfile&#34; class=&#34;headerlink&#34; title=&#34;1. docker-prod&amp;#x2F;app&amp;#x2F;Dockerfile&#34;&gt;&lt;/a&gt;&lt;strong&gt;1. docker-prod&amp;#x2F;app&amp;#x2F;Dockerfile&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;此文件定义了 PHP 应用容器的构建规则，基于 PHP 8.4 FPM Alpine 镜像，并安装了 Laravel 所需的所有扩展。&lt;/p&gt;
&lt;figure class=&#34;highlight dockerfile&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 1. 基础镜像升级到 PHP 8.4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;FROM&lt;/span&gt; php:&lt;span class=&#34;number&#34;&gt;8.4&lt;/span&gt;-fpm-alpine&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 设置工作目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; /var/www/html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 2. 优化构建过程：合并依赖安装，并使用 virtual group 以便后续清理&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;RUN&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; apk add --no-cache \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# 核心系统工具&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    zip \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    unzip \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# PHP 扩展依赖&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    libzip-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    libpng-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    jpeg-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    freetype-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    icu-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# 创建一个名为 .build-deps 的临时构建依赖组&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;amp;&amp;amp; apk &lt;span class=&#34;keyword&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; --no-cache --virtual .build-deps \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$PHPIZE_DEPS&lt;/span&gt; \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    zlib-dev \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    linux-headers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 3. 借鉴 Sail，补全 Laravel 所需的核心扩展&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;RUN&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; docker-php-ext-configure gd --with-freetype --with-jpeg \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    &amp;amp;&amp;amp; docker-php-ext-install -j$(&lt;span class=&#34;built_in&#34;&gt;nproc&lt;/span&gt;) \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    pdo_mysql \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    bcmath \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    gd \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    exif \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    intl \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    zip \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    pcntl \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    sockets \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    &amp;amp;&amp;amp; pecl install redis \&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-bash&#34;&gt;    &amp;amp;&amp;amp; docker-php-ext-enable redis&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 4. 清理工作：删除临时的构建依赖，减小镜像体积&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;RUN&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; apk del .build-deps&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 安装 Composer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;COPY&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; --from=composer:latest /usr/bin/composer /usr/bin/composer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 拷贝 composer 文件并安装依赖&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;COPY&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; composer.json composer.lock ./&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 生产环境优化：不安装开发依赖，并优化自动加载&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 注意：如果需要在容器内运行 seeder，请暂时移除 --no-dev 参数并重新构建&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;RUN&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; composer install --no-interaction --no-plugins --no-scripts --prefer-dist --no-dev -o&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 拷贝项目代码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;COPY&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt; . .&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 注意：权限问题将在首次启动后通过 exec 命令解决，以确保与宿主机挂载的目录权限正确&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# RUN chown -R www-data:www-data /var/www/html/storage /var/www/html/bootstrap/cache&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 暴露 9000 端口&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXPOSE&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;9000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-docker-prod-nginx-default-conf&#34;&gt;&lt;a href=&#34;#2-docker-prod-nginx-default-conf&#34; class=&#34;headerlink&#34; title=&#34;2. docker-prod&amp;#x2F;nginx&amp;#x2F;default.conf&#34;&gt;&lt;/a&gt;&lt;strong&gt;2. docker-prod&amp;#x2F;nginx&amp;#x2F;default.conf&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;此文件定义了 Nginx 的配置规则，实现了 HTTP 到 HTTPS 的自动重定向，并配置了 SSL 证书和 PHP-FPM 的转发规则。&lt;/p&gt;
&lt;figure class=&#34;highlight nginx&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;section&#34;&gt;server&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;listen&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;server_name&lt;/span&gt; _; &lt;span class=&#34;comment&#34;&gt;# 匹配任何主机名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;301&lt;/span&gt; https://&lt;span class=&#34;variable&#34;&gt;$host&lt;/span&gt;&lt;span class=&#34;variable&#34;&gt;$request_uri&lt;/span&gt;; &lt;span class=&#34;comment&#34;&gt;# 将所有 HTTP 请求重定向到 HTTPS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;section&#34;&gt;server&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;listen&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;443&lt;/span&gt; ssl;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;server_name&lt;/span&gt; _;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# SSL 证书配置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;ssl_certificate&lt;/span&gt; /etc/nginx/certs/lynx.pem;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;ssl_certificate_key&lt;/span&gt; /etc/nginx/certs/lynx-key.pem;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;ssl_protocols&lt;/span&gt; TLSv1.&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt; TLSv1.&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;root&lt;/span&gt; /var/www/html/public;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attribute&#34;&gt;index&lt;/span&gt; index.php index.html;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;section&#34;&gt;location&lt;/span&gt; / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;try_files&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$uri&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$uri&lt;/span&gt;/ /index.php?&lt;span class=&#34;variable&#34;&gt;$query_string&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;section&#34;&gt;location&lt;/span&gt; &lt;span class=&#34;regexp&#34;&gt;~ \.php$&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;try_files&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$uri&lt;/span&gt; =&lt;span class=&#34;number&#34;&gt;404&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;fastcgi_split_path_info&lt;/span&gt;&lt;span class=&#34;regexp&#34;&gt; ^(.+\.php)(/.+)$&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;# 注意这里的 fastcgi_pass 指向的是 app 服务的名称和端口&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;fastcgi_pass&lt;/span&gt; app:&lt;span class=&#34;number&#34;&gt;9000&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;fastcgi_index&lt;/span&gt; index.php;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;include&lt;/span&gt; fastcgi_params;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;fastcgi_param&lt;/span&gt; SCRIPT_FILENAME &lt;span class=&#34;variable&#34;&gt;$document_root&lt;/span&gt;&lt;span class=&#34;variable&#34;&gt;$fastcgi_script_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;fastcgi_param&lt;/span&gt; PATH_INFO &lt;span class=&#34;variable&#34;&gt;$fastcgi_path_info&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;section&#34;&gt;location&lt;/span&gt; &lt;span class=&#34;regexp&#34;&gt;~ /\.ht&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attribute&#34;&gt;deny&lt;/span&gt; all;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;3-docker-compose-prod-yml&#34;&gt;&lt;a href=&#34;#3-docker-compose-prod-yml&#34; class=&#34;headerlink&#34; title=&#34;3. docker-compose.prod.yml&#34;&gt;&lt;/a&gt;&lt;strong&gt;3. docker-compose.prod.yml&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;此文件是 Docker Compose 的服务编排配置，定义了应用所需的所有服务：PHP 应用、Nginx、MySQL、Redis 和队列处理器。&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;services:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 1. Laravel 应用服务 (PHP-FPM)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;build:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;context:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;dockerfile:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;docker-prod/app/Dockerfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_app&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;working_dir:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/var/www/html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;./:/var/www/html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;comment&#34;&gt;# 使用匿名卷保护镜像中已构建的 vendor 和 node_modules 目录不被宿主机覆盖&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/var/www/html/vendor&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/var/www/html/node_modules&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;networks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx-network&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# 确保 App 在数据库和 Redis 健康后才启动&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;depends_on:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;mysql:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;condition:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;service_healthy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;redis:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;condition:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;service_healthy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 2. Nginx 服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;nginx:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;nginx:alpine&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;80:80&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;443:443&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;./:/var/www/html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;./docker-prod/nginx/default.conf:/etc/nginx/conf.d/default.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;./docker-prod/certs:/etc/nginx/certs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;depends_on:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;app&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;networks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx-network&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 3. MySQL 数据库服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;mysql:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;mysql:8.0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_mysql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;environment:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;MYSQL_DATABASE:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;$&amp;#123;DB_DATABASE&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;MYSQL_ROOT_PASSWORD:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;$&amp;#123;DB_PASSWORD&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;MYSQL_PASSWORD:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;$&amp;#123;DB_PASSWORD&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;MYSQL_USER:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;$&amp;#123;DB_USERNAME&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_mysql_data:/var/lib/mysql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;3306:3306&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;networks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx-network&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# 从 Sail 借鉴的健康检查，确保数据库服务真正可用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;healthcheck:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;test:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;quot;CMD&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;mysqladmin&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;ping&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;-p$&amp;#123;DB_PASSWORD&amp;#125;&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;retries:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;timeout:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;5s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 4. Redis 服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;redis:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;redis:alpine&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_redis&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_redis_data:/data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;networks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx-network&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# 从 Sail 借鉴的健康检查，确保 Redis 服务真正可用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;healthcheck:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;test:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;quot;CMD&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;redis-cli&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;ping&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;retries:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;timeout:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;5s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 5. Laravel Queue Worker 服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;queue-worker:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;build:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;context:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;dockerfile:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;docker-prod/app/Dockerfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx_queue_worker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;php&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;artisan&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;queue:work&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;--verbose&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;--tries=3&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;--timeout=90&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;working_dir:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/var/www/html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;./:/var/www/html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/var/www/html/vendor&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/var/www/html/node_modules&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;networks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;lynx-network&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# 确保 Worker 也在数据库和 Redis 健康后才启动&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;depends_on:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;mysql:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;condition:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;service_healthy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;redis:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;condition:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;service_healthy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 定义网络&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;networks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;lynx-network:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;driver:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;bridge&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 定义数据卷 (用于持久化)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;lynx_mysql_data:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;driver:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;local&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;lynx_redis_data:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;driver:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;local&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;4-dockerignore&#34;&gt;&lt;a href=&#34;#4-dockerignore&#34; class=&#34;headerlink&#34; title=&#34;4. .dockerignore&#34;&gt;&lt;/a&gt;&lt;strong&gt;4. .dockerignore&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;此文件用于指定在构建 Docker 镜像时需要忽略的文件和目录，可以显著减小镜像体积并提高构建速度。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;.git&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.github&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.gitignore&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.env&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.env.example&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/vendor/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/node_modules/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker-compose.yml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/docker/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.idea&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.vscode&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;*.DS_Store&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h2 id=&#34;六、总结&#34;&gt;&lt;a href=&#34;#六、总结&#34; class=&#34;headerlink&#34; title=&#34;六、总结&#34;&gt;&lt;/a&gt;&lt;strong&gt;六、总结&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;至此将 Laravel 项目通过 Docker 进行生产环境部署的完整流程已介绍完毕。这套方案具有以下特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ &lt;strong&gt;容器化&lt;/strong&gt;：所有服务通过 Docker 隔离运行，环境一致性强&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;易于部署&lt;/strong&gt;：一键构建和启动，减少环境配置问题&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;生产优化&lt;/strong&gt;：包含 SSL 支持、健康检查、自动重启等生产级特性&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;易于维护&lt;/strong&gt;：提供完整的日常运维命令，代码更新流程清晰&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;可扩展性&lt;/strong&gt;：基于 Docker Compose，方便后续添加其他服务&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果在部署过程中遇到问题，请检查：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Docker Desktop 是否正常运行&lt;/li&gt;
&lt;li&gt;端口 80、443、3306 是否被占用&lt;/li&gt;
&lt;li&gt;.env 文件中的配置是否正确&lt;/li&gt;
&lt;li&gt;storage 目录权限是否正确设置&lt;/li&gt;
&lt;/ol&gt;
 ]]></description>
        </item>
    </channel>
</rss>
