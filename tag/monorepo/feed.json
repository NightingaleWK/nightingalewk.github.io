{
    "version": "https://jsonfeed.org/version/1",
    "title": "雪漫城的风宅 • All posts by \"monorepo\" tag",
    "description": "この世界は好都合に未完成 だから知りたいんだ —— チ。-地球の運動について-",
    "home_page_url": "https://nightingalewk.cn",
    "items": [
        {
            "id": "https://nightingalewk.cn/2025/06/26/75.%20%E5%A6%82%E4%BD%95%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%20Git%20%E4%BB%93%E5%BA%93%EF%BC%88Monorepo%20%E5%AE%9E%E8%B7%B5%EF%BC%89/",
            "url": "https://nightingalewk.cn/2025/06/26/75.%20%E5%A6%82%E4%BD%95%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%20Git%20%E4%BB%93%E5%BA%93%EF%BC%88Monorepo%20%E5%AE%9E%E8%B7%B5%EF%BC%89/",
            "title": "如何合并两个独立的 Git 仓库（Monorepo 实践）",
            "date_published": "2025-06-26T02:00:00.000Z",
            "content_html": "<p>本文是一份将两个完全独立、无关联历史的 Git 仓库合并到一个新仓库（Monorepo）的完整操作指南。我们将把每个旧仓库的内容及其完整提交历史，迁移到新仓库的不同子目录中。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"核心思路\"><a href=\"#核心思路\" class=\"headerlink\" title=\"核心思路\"></a>核心思路</h2><p>我们的目标是创建一个全新的仓库 <code>sushang-combined</code>，并将 <code>sushang-v1</code> 和 <code>sushang-v2</code> 两个仓库的所有内容和历史记录，分别完整地移入 <code>sushang-combined</code> 下的 <code>sushang-v1/</code> 和 <code>sushang-v2/</code> 子目录中。</p>\n<h2 id=\"第一阶段：环境准备\"><a href=\"#第一阶段：环境准备\" class=\"headerlink\" title=\"第一阶段：环境准备\"></a>第一阶段：环境准备</h2><p>首先，创建工作区，并克隆所有需要的仓库。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 创建一个专门的工作目录</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> git-merge-project &amp;&amp; <span class=\"built_in\">cd</span> git-merge-project</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 克隆你的两个源仓库 (请替换为你的实际URL)</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> &lt;URL_for_sushang-v1&gt;</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> &lt;URL_for_sushang-v2&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 创建并初始化最终要合并到的目标仓库</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> sushang-combined</span><br><span class=\"line\"><span class=\"built_in\">cd</span> sushang-combined</span><br><span class=\"line\">git init</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第二阶段：重构源仓库\"><a href=\"#第二阶段：重构源仓库\" class=\"headerlink\" title=\"第二阶段：重构源仓库\"></a>第二阶段：重构源仓库</h2><p>此阶段是关键。我们需要在每个源仓库中，将所有文件移入一个与仓库同名的子目录。<strong>这个过程需要对 <code>sushang-v1</code> 和 <code>sushang-v2</code> 分别执行一次。</strong></p>\n<p>下面以 <code>sushang-v1</code> 为例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 进入 sushang-v1 的本地克隆目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../sushang-v1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 创建子目录</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> sushang-v1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 将所有文件和目录移动到新子目录中</span></span><br><span class=\"line\"><span class=\"comment\"># 使用 git mv 至关重要，它能让 Git 追踪文件移动，保留历史记录！</span></span><br><span class=\"line\"><span class=\"comment\"># -k 标志会忽略移动过程中可能出现的无关紧要的错误</span></span><br><span class=\"line\">git <span class=\"built_in\">mv</span> -k * sushang-v1/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 单独处理以点开头的隐藏文件（如 .gitignore, .github 等）</span></span><br><span class=\"line\">git <span class=\"built_in\">mv</span> .gitignore sushang-v1/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 提交这次结构调整</span></span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;chore: Restructure repository for monorepo merge&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>请返回上一级目录，对 <code>sushang-v2</code> 仓库重复上述 1-5 步。</strong></p>\n<h2 id=\"第三阶段：执行合并\"><a href=\"#第三阶段：执行合并\" class=\"headerlink\" title=\"第三阶段：执行合并\"></a>第三阶段：执行合并</h2><p>现在，所有准备工作就绪，可以开始真正的合并操作。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 返回合并目标仓库</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../sushang-combined</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 合并 sushang-v1</span></span><br><span class=\"line\"><span class=\"comment\">#    将本地重构后的 sushang-v1 仓库添加为名为 v1 的远程源</span></span><br><span class=\"line\">git remote add v1 ../sushang-v1</span><br><span class=\"line\"><span class=\"comment\">#    从 v1 拉取所有历史数据</span></span><br><span class=\"line\">git fetch v1</span><br><span class=\"line\"><span class=\"comment\">#    合并 v1 的主分支，--allow-unrelated-histories 是关键！</span></span><br><span class=\"line\">git merge v1/main --allow-unrelated-histories -m <span class=\"string\">&quot;feat: Merge sushang-v1 history&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 合并 sushang-v2</span></span><br><span class=\"line\"><span class=\"comment\">#    以同样的方式添加并合并 v2</span></span><br><span class=\"line\">git remote add v2 ../sushang-v2</span><br><span class=\"line\">git fetch v2</span><br><span class=\"line\">git merge v2/main --allow-unrelated-histories -m <span class=\"string\">&quot;feat: Merge sushang-v2 history&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 验证结果</span></span><br><span class=\"line\"><span class=\"comment\">#    执行 ls，应能看到 sushang-v1 和 sushang-v2 两个目录</span></span><br><span class=\"line\"><span class=\"comment\">#    执行 git log --graph --oneline --all 查看合并后的历史图谱</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -la</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第四阶段：发布到-GitHub\"><a href=\"#第四阶段：发布到-GitHub\" class=\"headerlink\" title=\"第四阶段：发布到 GitHub\"></a>第四阶段：发布到 GitHub</h2><p>将本地合并好的新仓库推送到远程。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 在 GitHub 上创建一个新的、空的仓库，例如 sushang-combined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 在本地 sushang-combined 目录中，关联到你刚创建的远程仓库</span></span><br><span class=\"line\">git remote add origin &lt;URL_for_new_github_repo&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 将本地的完整历史推送到 GitHub</span></span><br><span class=\"line\"><span class=\"comment\">#    -u 选项会建立本地 main 分支与远程 origin/main 分支的追踪关系</span></span><br><span class=\"line\">git push -u origin main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. (可选) 清理本地的临时远程源</span></span><br><span class=\"line\">git remote <span class=\"built_in\">rm</span> v1</span><br><span class=\"line\">git remote <span class=\"built_in\">rm</span> v2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第五阶段：归档旧仓库\"><a href=\"#第五阶段：归档旧仓库\" class=\"headerlink\" title=\"第五阶段：归档旧仓库\"></a>第五阶段：归档旧仓库</h2><p>为了避免混淆，并完整保留 Issues、Pull Requests 等宝贵信息，最佳实践是<strong>归档</strong>（Archive）而不是删除旧仓库。</p>\n<p>对 <code>sushang-v1</code> 和 <code>sushang-v2</code> 在 GitHub 上的仓库，分别执行以下操作：</p>\n<ol>\n<li><strong>更新仓库描述</strong>：在仓库主页点击 “Edit”，修改描述，明确指出项目已归档，并提供新仓库 <code>sushang-combined</code> 的链接。例如：“**[ARCHIVED]** Development continues at [link to sushang-combined].”</li>\n<li><strong>更新 README</strong>：在 <code>README.md</code> 文件顶部添加醒目通知，引导访问者前往新仓库。</li>\n<li><strong>执行归档</strong>：<ul>\n<li>进入仓库的 <code>Settings</code> 页面。</li>\n<li>滚动到底部的 <code>Danger Zone</code>（危险区域）。</li>\n<li>点击 <code>Archive this repository</code>（归档此仓库）。</li>\n<li>按提示输入仓库名称进行确认。</li>\n</ul>\n</li>\n</ol>\n<p>至此，您已成功将两个独立仓库完整地合并为一个，并完成了所有后续整理工作。</p>\n",
            "tags": [
                "Git",
                "Monorepo",
                "DevOps"
            ]
        }
    ]
}